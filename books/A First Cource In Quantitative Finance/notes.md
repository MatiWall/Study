
# Propability and Measure

## Quick calculation  2.1
Verify that for $A_1, A_2\in \mathcal{F}$ the intersection $A_1 \cap A_2$ is also in $\mathcal{F}$
## Solution
A $\sigma$-algebra is defined as:
1. $\mathcal{F}$ is nonempty
2. if $A\in \mathcal{F}$ then $A^C\in \mathcal{F}$
3. if $A_1, A_2,\ldots \in \mathcal{F}$ then $\cup_{n=1}^{N}A_n \in \mathcal{F}$

From definition 2 we know that $A_1^C$ and $A_2^C$ are also in $\mathcal{F}$ and from 3. that $A_1^C \cup A_2^C \in \mathcal{F}$. From the De Morgan's rule we know
$$
    \cap_{n=1}^{N}A_n = \left(\cup_{n=1}^N A_n^C\right)^C
$$
we see that  $A_1 \cap A_2 \in \mathcal{F}$
<hr style="border-top: 0.1px dashed;">

A family $\mathcal{F}$ of sets (events) $A_1, A_2,...$ is called a $\sigma$-algbra if it satisfy the following conditions
1. $\mathcal{F}$ is non empty
2. if $A \in \mathcal{F}$ then $A^c \in \mathcal{F}$
3. if $A_1, A_2, ... \in \mathcal{F}$ then $\bigcup_{n=0}^\infty A_n \in \mathcal{F}$

>**$\sigma$-algebra** is used to ensure consistency when defining measures on a collection of events or sets.

<div style="color: red">go back and take notes from begining untill equation 2.4 (first quick calculation)</div>

> **Power Set** - The power set $2^{\Omega}$ is the set of all subesets of $\Omega$ that can be constructed. There are $2^{\#\Omega}$ possible subsets.

For uncountable infinite set like $\Omega = \mathbb{R}$ is too large, instead one uses the $\sigma-\text{algebra}$ generated by all open intervals $(a, b)$ in \mathbb{R} for $a<b$. This is known as the Borel-$\sigma$-algebra ($\mathcal{B}(\mathbb{R})$). From the definition of the $\sigma$-algebra this containe way more than just he open intervals. All sets than can be generated from open, half open and closed intervals are in the Bores-$\sigma$-algebra. For example sets like $(a,c)^C = (-\infty, a] \cup [b, \infty)$ and the set generated by 
$$ \bigcap_{n=1}^\infty (a-\frac{1}{n}, b+\frac{1}{n})=[a, b] $$
Here for every point chosen arbitary close to the left of $a$ or to the right of $b$ an $n$ can be chosen such that this point in not in the set i.e. it becomes a closed set from $a$ to $b$.

> **Why intersection and not Limit**
> Limit is not a valid approch in set theory.

> **Open and Closed Sets** A set is oppen if for every point in the set there is a small negboring region that is also in the set. For example $(a,b)$ is an open aset as it includes all points between $a$ and $b$ and the endpoints are not included. Also $x\gt5$ is an open set whereas $x\ge 5$ is a closed set.

## Quick Calculation: 2.2
Considering a die throw where all that matters to us is if the number on top is even or odd. The sigma algebra generated by this is $$\mathcal{F} = \{\emptyset, \{2, 4, 6\}, \{1,3,5\}, \Omega\}$$ where
$\Omega = \{1,2,3,4,5,6\}$.
Verify that $\mathcal{F}$ is a valid $\sigma$-algebra.

**Condition 1: Non Empty** - Obviously not (Fulfilled).

**Condition 2: Complement** - Consider the even numbers $A=\{2, 4, 6\}$, $A^C$ will then be the odd numbers as seen from definition of $\Omega$ and vise versa.

**Condition 3: Countable Unions** - Say we have $A_1 = \{1, 3, 5\}$ and $A_2 = \{2,4,6\}$ the union $A_1 \cup A_2 = \Omega$ i.e. this is also in the $\sigma$-alegbra. Also any union of $A_n$ with $\emptyset$ returns $A_n$ i.e. in the set.
<hr style="border-top: 0.1px dashed;">

Consider the $\sigma$-algebra generated by the throw of a die where we are only interested in wether the number on top is even or odd. The sigma algebra generated by this is $$\mathcal{F} = \{\emptyset, A, A^C, \Omega\}$$ where $A = \{2, 4, 6\}$ and $A^C = \{1,3,5\}$. In general a $\sigma$-algebra generated by the event $A$ is $\mathcal{F} = \{\emptyset, A, A^C, \Omega\}$ also denoted $\mathcal{F}=\sigma(A)$, which is the smallest $\sigma$-algebra containint $A$.

A function $\mu: \mathcal{F} \rightarrow \mathbb{R}^+_0$ with properties:
1. $\mu(\emptyset) = 0$
2. $\mu \left(\bigcup_{n=1}^m A_n \right) = \Sigma_{n=1}^m \mu(A_n)$ for $A_1, A_2,... \in \mathcal{F}$ and $A_i \cap A_j = \emptyset$ for $i\neq j$

> Note: $\mathbb{R}^+_0$  represents the set of all non negative numbers $\{x\in\mathbb{R}\mid x \ge 0\}$. It could also have been like $\mathbb{R}^+_2$ which would be $\{x\in\mathbb{R}\mid x \ge 2\}$

$\mu$ is called a measure on $(\Omega, \mathcal{F})$. The triplet $(\Omega, \mathcal{F}, \mu)$ is called a measure space (sometimes also proppability triplet). A measure is the most natural concept of a length assigned to all sets in the $\sigma$-algebra.
> Note: Consider the measurable space $(\mathbb{R}, \mathcal{B})$ with the Borel-$\sigma$-algebra generated by all half open intervals $(a, b]$ for $a \le b$ and choosing the Lebesgue-measure $\mu((a, b]) = b-a$

In propaility theory one assigns the overall length $\mu(\Omega) = 1$ to $\Omega$. The associated measure is called probability and is abbreviated $P(A)$ for $A \in \mathcal{F}$. The triplet $(\Omega, \mathcal{F}, P)$ is called the probability space.

# Filtrations and the Flow of Information 
Consider tossing a coin two times in succession. The outcomes can be labeled $$\Omega = \{(H, H), (H, T), (T, H), (T, T)\}$$. Inventing the variable $t$ to track occurred number of tosses this can take values $t \in \{0, 1, 2\}$. We then ask, what is the $\sigma$-algebra $\mathcal{F}_t$ generated by the coin tossing at $t$. At $t=0$ $$\mathcal{F}_0 = \{\emptyset, \Omega\}$$ 
> **Empty set and Sample Space**: The empty set and sample space are included in the $\sigma$-algebra for consistency. It ensures that the $\sigma$-algebra is closed under complement and countable unions. $\sigma$-algebras are used to structure the sets on which you can define measures or probabilities. Including the empty set and the sample space ensures that the $\sigma$-algebra adheres to the necessary mathematical properties and can be used consistently in probability and measure theory.

Assuming that the first toss is $H$ we know that the event $A=\{(H, H), (H, T)\}$ has happened at $t=1$. Adding the required unions and complement to obtains $$ \mathcal{F}_1 = \{\emptyset, \{(H, T), (H, H)\}, \{(T, T), (T, H)\}, \Omega\}$$

>**Complement**: Taking the complement means creating a new set with all the elements that are not in the original set. <br> 
Given a universal set $U$ and a subset $A \subseteq U$ the complement is given $$A^C = \{x \in U \mid x \notin A\}$$ i.e. $A^c$ consists of all elements not in $A$. <br>
In probability theory $P(A^c)=1-P(A)$ 

By comparing $\mathcal{F}_0$ and $\mathcal{F}_1$ we see that the finer the partition of the $\sigma$-algebra the more information is revealed by the history of the process. Also $\mathcal{F}_0 \subset \mathcal{F}_1$ indicating that no information is forgotten. $\mathcal{F}_t$ captures the information up until $t$ and $\mathcal{F}_{t-1} \subset \mathcal{F}_t$ indicated that no information is lost.  

Considering the final toss we are able to say exactly which events happened or not like $(T, T)$ or $(H, T)$ i.e. $\mathcal{F}_2$ has the finest possible partition structure. Generating the $\sigma$-algebra by taking countable unions and complements you get the power set $$\mathcal{F}_2 = 2^\Omega$$


<div style="color: red">Please go through the above and make sure you understand. Unsure how a sigma algebra is generated</div>


## Quick Calculation 2.3
Convince yourself that the natural filtration generated by observing the events $A_1=\{(H, H), (H, T)\}$ and $A_2={(H, T)}$ has only eight elements.

>**Natural Filtration** - A filtration is a family of $\sigma$-algebras $\{\mathcal{F}_t\}_{t \ge 0}$ indexed by time, where each $\mathcal{F}_t$ represents the information available up to time $t$. A filtration is called natural if it is generated by the stochastic process itself.

Starting by listing all sets

$\mathcal{F}_0 = \{\emptyset, \Omega\}$

$\mathcal{F}_1 = \{\emptyset,\{(H, H), (H, T)\}, \{(T, T), (T, H)\}, \Omega\}$

1. $\emptyset$
2. $\Omega = \{(H, H), (H, T), (T, T), (T, H)\}$
3. $A_1 = \{(H, H), (H, T)\}$
4. $A_1^c = \{(T, T), (T, H)\}$
5. $A_2 = \{(H, T)\}$
6. $A_2^c = \{(H, H), (T, T), (T, H)\}$
* $A_1 \cup A_2 =  \{(H, H), (H, T)\} \cup \{(H, T)\} = A_1$ 
7. $A_1 \cap A_2 =  \{(H, H), (H, T)\} \cap \{(H, T)\} = \{(H, H)\}$
8. $(A_1 \cap A_2)^c =  \{ (H, T), (T, T), (T, H)\}$

# Conditional Probability
Consider the probability space $\mathcal{F}_A=\{A\cap B: B \in \mathcal{F}\}$ i.e. the family of all intersections of $A$ with all events in $\mathcal{F}$ 

Consider a mesurable space $(\Omega, \mathcal{F})$ for a six sided die and $\mathcal{F}=2^\Omega$. Let $A = \{2, 4, 6\}$ be the event for throwing an even number. Which events are included in $\mathcal{F}_A$ and why is it a $\sigma$-algebra. The intersection of $A$ with all other events in $\mathcal{F}$ generates the following family of sets
$$\mathcal{F}_A = \{\emptyset, \{2\}, \{4\}, \{6\}, \{2, 4\}, \{2, 6\}, \{4, 6\}, A\} $$
we see that $\mathcal{F}_A$ is itself the power set of $A$ and there for a $\sigma$-algebra.

If $P(A)>0$ the conditional probability $P(B\mid A)$ is defined as 
$$P(B\mid A) = \frac{P(B \cap A)}{P(A)}$$
The triplet $(A, \mathcal{F}_A, P(\cdot \mid A)$ forms a new probability space.

**Example** Take the measurable space $(\Omega, \mathcal{F})$ for a six sided die and the probability measure $$P(B) = \frac{\#B}{6}$$ for all $B \in \mathcal{F}$. Chose an event $A = \{2, 4, 6\}$ what are the conditional probabilities $P(A\mid A), P(\{2\}\mid A)$ and $P(\{5\}\mid A)$? First notice that $P(A)=\frac{1}{3}$ to obtain
$$P(A \mid A)= \frac{A \cap A}{P(A)} = \frac{P(A)}{P(A)}=1$$
$$P(\{2\} \mid A)= \frac{\{2\} \cap A}{P(A)} = \frac{P(\{2\})}{P(A)}=\frac{\frac{1}{6}}{\frac{1}{3}}=\frac{1}{2}$$
$$P(\{5\} \mid A)= \frac{\{5\} \cap A}{P(A)} = \frac{P(\emptyset)}{P(A)}=0$$
> The conditional probability generates a new measurable space in which the event is evaluated under the condition $A$.  In this space, the outcomes are restricted to those in $A$, and the probabilities are recalibrated based on this restriction. 

An immediate consequence of the definition of conditional probability is Bayes' rule
$$P(B\mid A)=\frac{P(A\mid B)P(B)}{P(A)}=\frac{P(A \mid B) P(B)}{P(A \mid B) P(B)+P(A \mid B^C) P(B^C)}$$


## Quick Calculation 2.4 
Prove this statement
$$P(B\mid A)=\frac{P(A\mid B)P(B)}{P(A)}=\frac{P(A \mid B) P(B)}{P(A \mid B) P(B)+P(A \mid B^C) P(B^C)}$$
using additivity property of measures. 

The statement $P(A)=P(A \mid B) P(B)+P(A \mid B^C) P(B^C)$ trivially holds as it says $P(A)$ is equivalent to the sum of probabilities for $A$ if $B$ plus $A$ if not $B$. We can write $P(A) = P(A \cup B) + P(A \cup B^C) $ and using the definition of Bayes' rule we get the denominator.

## Example: Medical Test and Bayes' Rule

### Problem:
Suppose there is a disease that affects 1% of a population. A test exists for this disease, and it has the following properties:
- **True positive rate (sensitivity)**: 90% (if you have the disease, the test is positive 90% of the time).
- **False positive rate**: 5% (if you don’t have the disease, the test is positive 5% of the time).

Given that a person tests positive, we want to find the probability that the person actually has the disease.

### Step 1: Define the events
- $ D $: The event that the person has the disease.
- $ D^C $: The event that the person does not have the disease.
- $ T^+ $: The event that the test result is positive.

We want to find $P(D \mid T^+)$, the probability that the person has the disease given a positive test result.

### Step 2: Apply Bayes' Rule
Bayes' Rule is given by:

$$
P(D \mid T^+) = \frac{P(T^+ \mid D) P(D)}{P(T^+)}.
$$

Where:
- $ P(T^+ \mid D)$ is the probability that the test is positive given that the person has the disease (this is the sensitivity, 90% or 0.9).
- $P(D)$ is the prior probability of having the disease (1% or 0.01).
- $P(T^+)$ is the total probability of testing positive, which can be calculated using the law of total probability:

$$
P(T^+) = P(T^+ \mid D) P(D) + P(T^+ \mid D^C) P(D^C).
$$

Here:
- $P(T^+ \mid D^C)$ is the probability of testing positive given that the person does not have the disease (the false positive rate, 5% or 0.05).
- $P(D^C)$ is the probability of not having the disease (99% or 0.99).

### Step 3: Calculate $P(T^+)$
$$
P(T^+) = (0.9 \times 0.01) + (0.05 \times 0.99) = 0.009 + 0.0495 = 0.0585.
$$

### Step 4: Apply the formula
Now, apply Bayes' Rule to compute $ P(D \mid T^+) $:

$$
P(D \mid T^+) = \frac{0.9 \times 0.01}{0.0585} = \frac{0.009}{0.0585} \approx 0.1538.
$$

### Interpretation:
Given that a person tests positive, the probability that they actually have the disease is about **15.38%**. Despite the positive test result, the probability is still relatively low due to the low prevalence of the disease (1%) and the non-zero false positive rate.

## Probability Independence
In the case of independent probabilities we can visualize it as a rectangle (Fig 2.2), i.e. orthogonal sides (orthogonality is equivalent to independence). The Lebesgue-measure for the rectangle $A\cap B$ is $\mu(A \cap B)=\mu[A] \mu(B)$ i.e. the area. Analogously 
$$P(A \cap B)=P(A)P(B)$$
In the case of independence condtional probabilities collapse to unconditional probabilities
$$P(A \mid B)= \frac{P(A \cap B)}{P(B)}=\frac{P(A)(B)}{P(B)}=P(A)$$

## Quick Calculation 2.5
Trivial


## Quick Calculation 2.6 
Show that for a six sided die, the events of throwing an even number $A=\{2, 4, 6\}$ and throwing a number less than or equal to 4 $B=\{1, 2, 3, 4\}$ are also independent.

1. $P(A) = \frac{1}{2}$
2. $P(B) = \frac{2}{3}$
3. $P(A \cap B) = P(\{2, 4\}) = \frac{1}{3}$

Checking that $P(A \cap B) = P(A)P(B)$ ✅

# Random Variables and Stochastic Processes
So far we have seen a very elegant and rigorous model fra random experiments which is not very practical. Luckily it is possible to map the measurable space $(\Omega, \mathcal{F})$ onto another measurable space $(E, \mathcal{B})$ equipped with a distribution function induced by the original probability $P$. The link is established by a random variable or process.
> The designation random variable is a misnomer as it is actually a function $X: \Omega \rightarrow E$

In the case of a coin toss one can define following random variable 
$$
X(\omega)=
\begin{cases}
1 & \text{for } \omega = H \\
0  & \text{for } \omega = T
\end{cases}
$$
This link is only meaningful if the inverse mapping also exists $$X^-1 (B) = \{\omega \in \Omega : X(\omega) \in B\}$$. This is trivially fulfilled in the one to one mapping of the coin example.

> Point of the above is that a random variable maps from the measurable $\Omega$ to some other measurable space $E$ space, and that it is often easier to do calculations in $E$.

Observing a family of random variables $X_t(\omega)$ labeled by a continuous or discrete index set $0\le t \le T$, there also a family of $\sigma$-algebras $\mathcal{F}_t$ induced by $X^{-1}$ in the original probability space. This is the concept of filtration. The family $X(\omega)$ is called a stochastic process. If the filtration $\mathcal{F}_t$ is generated by $X_t$ it is called the natural filtration and if the process $X_t$ is measurable with respect to $\mathcal{F}_t$ it is called adapted to this $\sigma$-algebra.

## Example 2.5 (Wiener Process)
The stochastic process $W_t$ characterized by
1. $W_0 = 0$
2. $W_t$ has independent increments
3. $W_t - W_s \sim N(0, t-s)$ for $0 \le s \le t$

is called a Wiener process (Brownian Motion) and is found all over quantitative finance. $N(0, t-s)$ represents the normal distribution with mean $0$ and variance $t-s$. For a given time interval $t-s$ $W$ is a continuous random variable density function 
$$
    f(w) = \frac{1}{\sqrt{2 \pi (t-s)}}e^{-\frac{1}{2}\frac{w^2}{t-s}}
$$

The corresponding distribution function is obtained by integration (as continuous) 
$$
F(w) = \int_{-\infty}^w f(x) \text{d}x
$$

A subtle feature of continuous random variables is the fact that a single point has probability zero. 

<hr style="border-top: 0.1px dashed;">

A technical consequence of this uncountable feature is not non empty spaces can have zero probability. They don not even have to be small. the set of all rational numbers has zero probability. Such a set is called a null set. A probability space is called complete if all subsets of null sets are included in $\mathcal{F}$. It is possible to include these subsets because most statements concern events with probability larger than zero. This is indicated by the phrase "almost surely". For example the Wiener process as almost surely continuous but non-differential paths i.e. this property is at most violated at events with zero probability.

# Moments of Random Variables
Even though probability distributions are sufficient to describe random variables they are not very descriptive. Moments are some additional feature to characterize additional features. The fist moment is the expectation value defined in discrete and continuous case as
$$
    E[X] = \sum_n x_n f(x_n) \ \text{or} E[X] = \int x f(x) \text{d}x
$$

The expectation value is defined as the first raw moment, the second moment is usually a central moment i.e. the moment around the expectation value called variance. It is defined as
$$
Var[X] = E[(X-E[X])^2]=E[X^2] - E[X]^2
$$

> Cental moment is a moment taking around a value, often mean, and raw moment is without a reference value. This also means that for $\mu=0$ raw and central moments are identical.

## Quick Calculation 2.7
Confirm the second equality in  $\text{Var}[X] = E[(X-E[X])^2]=E[X^2] - E[X]^2$

$$
E[(X-E[X])^2] = E[(X^2+E[X]^2-2X E[X])] = E[X^2] + E[X]^2 - 2 E[X] \cdot E[X] = E[X^2] - E[X]^2 
$$

<hr style="border-top: 0.1px dashed;">

The moments of a normal distribution are defined
$$
M_k = \int_{-\infty}^\infty (y-\mu)^k\frac{1}{\sqrt{2\pi\sigma}}e^{-\frac{1}{2}\left( \frac{y-\mu}{\sigma}\right)^2} \text{d}y = 
\begin{cases}
0 & \text{for odd} \\
(k-1)!!\sigma^k  & \text{for even}
\end{cases}
$$
All odd moments disappear as these describe asymmetry. The standardized third moment is called skewness. Even moments are related to the proportion of the probability mass located in the tails of the distribution. The standardized fourth moment is called kurtosis and is $3$ for a normal distribution. For most financial return time series it is between $6$ and $9$, indicating a more heavy tailed distribution than normal.

A related concept is that of mixed moments, the most prominent here being covariance. For two random variables $X$ and $Y$ the covariance is defined
$$
Cov[X, Y] = E[(X - E[X])(Y - E[Y])] = E[XY] - E[X]E[Y]
$$


## Quick Calculation 2.8
Verify the second equality in $Cov[X, Y] = E[(X - E[X])(Y - E[Y])] = E[XY] - E[X]E[Y]$

$$
E[(X - E[X])(Y - E[Y])] = E[XY - X E[Y - YE[X] + E[X]E[Y]]] = \newline E[XY] - E[X]E[Y] - E[Y]E[X] + E[X]E[Y] = E[XY] - E[X]E[Y]
$$
<hr style="border-top: 0.1px dashed;">

Covariance is a linear measure between two random variables $X$ and $Y$ as the expectation value is a linear function. If two random variables has covariance zero it does not necessarily mean that they are independent.

## Example 2.5
Consider $X \sim N(0,1)$ and $Y = X^2$. Obviously these are highly dependent but what is there covariance.
$$
\text{Cov}[X, Y] = E[X Y] -E[X]E[Y] = E[X^3] - E[X]E[X^2]=0
$$

<hr style="border-top: 0.1px dashed;">

If on the other hand two random variables are independent their covariance is guarantied to vanish. Only in the case of normally distributed random variables are vanishing and independence equivalent. It is often more intuitive to use a rescaled version called correlation
$$
\rho_{XY} = \frac{\text{Cov}[X,Y]}{\sqrt{\text{Var}[X] \text{Var}[Y]}}
$$
Correlation and covariance are in one to one correspondence i.e. uncorrelatied also means zero covariance.

# Characteristic Function and Fourier-Transform
The characteristic function of a random variable is the Fourier-transform of its probability density function
$$
\phi(u) = \int_{-\infty}^\infty e^{i u x}f(x) \text{d}x = E[e^{iux}]
$$ 
In order to add independent random variables we can use folding i.e. to calculate the probability for rolling a seven with two dies we do this
$$
g(k) = \sum_{n=1}^{6} f(n)f(k-n)
$$
It is a general feature of Fourier-transforms that the operation of folding in the initial space translates to multiplication in the Fourier-space.
> when working with sums of independent random variables the pdf of their sum $Z=X+Y$ is given by 
$$
f_Z(z) = (f_X \star f_Y)(z)
$$
when working in the fourier space with characteristic function this becomes
$$
\phi(z) = \phi(x) \phi(z)
$$
one can then take the inverse transform to get the distribution.

> A **characteristic** function in probability theory is a mathematical tool used to uniquely describe the probability distribution of a random variable. It is the Fourier transform of the probability density function (PDF) or the probability mass function (PMF) of a random variable.

> The difference between Probability Density Function (PDF) and Probability Mass Function (PMF) lies in the type of random variable they describe: continuous or discrete.

## Quick Calculation 2.9
Verify that $X \sim N(\mu,\sigma^2)$ has mean $\mu$ and variance $\sigma^2$. Remembering that the mean it the first moment and that the variance is the second central moment.

$$
\varphi_X(u) = E[e^{iuX}]=E[e^{iu(\sigma Z + \mu)}]=E[e^{iu\sigma Z}]E[e^{iu\mu}]=E[e^{iu\mu}]\varphi(\sigma u)
$$

Using that he characteristic function for a standard normal distribution is given by 
$$
    \varphi_Z(u) = e^{-\frac{1}{2}u^2}
$$
to get
$$
    \varphi_X(u) = e^{iu\mu-\frac{1}{2}u^2\sigma^2}
$$
Using that 
$$
E[X] = -i\frac{\text{d}\varphi(u)}{\text{d}u} \bigg|_{u=0}\ \ \text{and} \ \ E[X^2]=-\frac{\text{d}^2\varphi(u)}{\text{d}u^2} 
$$
to get

$$
E[X] = -i (i\mu - u\sigma^2)\varphi_X(u)\big|_{u=0}=\mu
$$
and
$$
\text{Var}(X)=-\left((i\mu - u\sigma^2)^2\varphi_X(u) - \sigma^2 \varphi_X(u)\right)\bigg|_{u=0} - \mu=\sigma^2
$$
Above could have been done easier using
$$
E[X]=E[\sigma Z + \mu] =\sigma E[Z] + \mu = \mu
$$
and
$$
E[X^2] - E[X]^2=E[\sigma^2 Z^2+\mu^2 + 2\sigma Z] - \mu^2=\sigma^2
$$

# Chapter 4: Utility Theory
Utility theory provides a mathematical framework to analyze and explain rational economic behavior. 
> In economics, utility is a measure of the satisfaction that a certain person has from a certain state of the world. 
## Lotteries
A lottery $L(W)$ describes the situation where a person could receive different wealth levels, but the exct wealth they receive depends on the state of the world, which is uncertain. The probability  $f(w_i)$ represents the likelihood of receiving a specific wealth level. The lottery therefore captures both the wealth outcomes and the associated probabilities.


Consider $W:\Omega \rightarrow \mathcal{W}$ that assigns to every state of a world a specific wealth $W(\omega_n)=w_n$. A lottery is a list of all probability masses associated with the different realizations of $w_n$ of the random variable $W$,
$$
L(W)=\left(f(w_1), \dots,f(w_n)\right)
$$
> Remember: Probability mass function is the probability distribution of a discrete random variable, and provides the possible values and their associated probabilities.

which can also be written as
$$
L=(p_1, \dots, p_n)
$$

## Quick Calculation 4.1
The compounded lottery will look like
$$
L=\left( L_1, L_2 \right)=(\frac{1}{4}, 0, \frac{1}{4}, 0, \frac{9}{20}, \frac{1}{20})
$$

## Preference Relations and Expected Utility
Given two lotteries we you might prefer one over the other or be indifferent. The personal preferences is described using preference relations
$$
L_1 \ge L_2 \ \leftrightarrow \ L_1\ \text{is better than}\ L_2 \newline
L_2 \ge L_1 \ \leftrightarrow \ L_2\ \text{is better than}\ L_1 \newline
L_1 \sim L_2 \ \leftrightarrow \ L_1\ \text{is indifferent to }\ L_2
$$
preference relations make it possible to order di

fferent lotteries but it is not always possible to realize such an order due to circular preferences.

Question is then under which conditions a rational preference order can be achieved. John Von Neumann and Oskar Morgenstern postulated four conditions


$$
\begin{aligned}
1. & \quad \text{Completeness:} \quad L_1 \succ L_2 \quad \text{or} \quad L_2 \succ L_1 \quad \text{or} \quad L_1 \sim L_2 \\
2. & \quad \text{Transitivity:} \quad \text{If } L_1 \succ L_2 \text{ and } L_2 \succ L_3, \text{ then } L_1 \succ L_3 \\
3. & \quad \text{Continuity:} \quad \text{If } L_1 \succ L_2 \succ L_3, \text{ then } \exists p \in (0,1) \text{ such that } L_2 \sim p L_1 + (1 - p) L_3\\
4. & \quad \text{Independence:} \quad \text{If } L_1 \sim L_2, \text{ then for any lottery } L_3 \text{ and any } p \in [0, 1], \\
   & \quad p L_1 + (1 - p) L_3 \sim p L_2 + (1 - p) L_3 \\
\end{aligned}
$$

Axiom 2 ensure that circular preferences can not happen. 

Assuming that these axioms are true it can be shown that there exists a a function $u: \mathcal{W} \rightarrow \mathbb{R}$ such that
$$
L_1\ge L_2 \Leftrightarrow \sum_{n=1}^N u(w_n)p_n \ge \sum_{n=1}^N u(w_n)q_n 
$$
where 
* $u(w_n)$ is the utility assigned to a wealth level $w_n$'
* $p_n$ is the probability of $w_n$ occurring in lottery $L_1$
* $q_n$ is the probability of $w_n$ occurring in lottery $L_2$
> Given these four axioms, it is possible to construct a utility function $u(w)$ that assigns a real number (utility) to each possible wealth outcome $u(w)$. This utility function allowsus to rank lotteries based on the expected utility. A lottery $L_1$ is preferred to another lottery $L_2$ if the expected utility of $L_1$ is greater than or equal to $L_2$

The utility function $u(w)$ represents an individuals for wealth outcomes. It is not unique and is determined from an individuals risk preferences.

The functional 
$$
U(L)=E[u(W)] = \sum_{n=1}^N u(w_n) p_n
$$
is called the von Neumann-Morgenstern-utility or expected utility. With the expected utilities we can now compare lotteries without the need for an extensive list of pairwise preference relations.

> It might seem restrictive that the same wealth states are used in both terms though when we compare lotteries with different sets of wealth states, we can expand the lotteries so they are represented over the same wealth states by introducing "missing" outcomes with zero probabilities. In other words, if two lotteries have different outcomes, we can still represent them as having the same possible outcomes by assigning zero probabilities to the outcomes that don’t occur in one lottery.

## Risk Aversion
Consider a coin flip game for all your wealth. Assume that your wealth is $V$ participation can be summarized by $\mathcal{W}=\{0, V, 2V\}$ with participation and not participation are described by the lotteries
$$
L_1 = \left(\frac{1}{2}, 0, \frac{1}{2}\right) \quad  \text{and} \quad L_2=(0,1,0).
$$
No one would actually take this bet even though the expectation value of the two are the same, as people are risk averse, i.e. you get less utility by doubling your wealth than you loose by loosing your entire wealth.

 Assuming a utility function $u(w)=w$ taking the bet or not will have the same utility, i.e. $u(w)=w$ belong to a risk neutral agent. This indicates that risk attitude has to be encoded into the utility. As the marginal utility for receiving a fixed amount of wealth decreases with you initial wealth we expect the following to hold
 $$
 \frac{\text{d}u}{\text{d}w}>0 \quad \text{and} \quad \frac{\text{d}^2u}{\text{d}w^2} \le 0
 $$
 for a risk-averse agent the curvature will be strictly less than zero.

 ## Measures of Risk Aversion
 A useful measure for the degree of risk aversion an agent exhibits can be stated as
 $$
 \text{ARA}(w)=-\frac{u''(w)}{u'(w)}
 $$
 and is known as the absolute risk aversion. For a concave utility $ \text{ARA}(w)\ge 0 $ where equality holds for risk-neutral agents. A version also exists where the current level of risk-aversion is scaled by the current level of wealth
 $$
  \text{RRA}(w)=-\frac{w u''(w)}{u'(w)}
 $$

 ## Certainty Equivalent and Risk Premium
 